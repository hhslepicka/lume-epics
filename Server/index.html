<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://slaclab.github.io/lume-epics/Server/" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>Server - lume-epics</title>
<link href="../css/bootstrap.min.css" rel="stylesheet"/>
<link href="../css/font-awesome.min.css" rel="stylesheet"/>
<link href="../css/base.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet"/>
<script defer="" src="../js/jquery-1.10.2.min.js"></script>
<script defer="" src="../js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
<div class="container">
<a class="navbar-brand" href="..">lume-epics</a>
<!-- Expander button -->
<button class="navbar-toggler" data-target="#navbar-collapse" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<!-- Expanded navigation -->
<div class="navbar-collapse collapse" id="navbar-collapse">
<!-- Main navigation -->
<ul class="nav navbar-nav">
<li class="navitem">
<a class="nav-link" href="..">Overview</a>
</li>
<li class="navitem">
<a class="nav-link" href="../Install/">Install</a>
</li>
<li class="dropdown">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Tutorial <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../BokehServer/">Bokeh Server</a>
</li>
<li>
<a class="dropdown-item" href="../Jupyter/">Jupyter Notebook Demo</a>
</li>
</ul>
</li>
<li class="dropdown active">
<a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Documentation <b class="caret"></b></a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../Layout/">Layout</a>
</li>
<li class="dropdown-submenu">
<a class="dropdown-item" href="#">Client</a>
<ul class="dropdown-menu">
<li>
<a class="dropdown-item" href="../Controller/">Controller</a>
</li>
<li>
<a class="dropdown-item" href="../Monitors/">Monitors</a>
</li>
<li>
<a class="dropdown-item" href="../Widgets/">Widgets</a>
</li>
</ul>
</li>
<li>
<a class="dropdown-item" href="../Model/">Model</a>
</li>
<li>
<a class="dropdown-item active" href="./">Server</a>
</li>
</ul>
</li>
</ul>
<ul class="nav navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="../Model/" rel="prev">
<i class="fa fa-arrow-left"></i> Previous
                                </a>
</li>
<li class="nav-item">
<a class="nav-link disabled" rel="next">
                                    Next <i class="fa fa-arrow-right"></i>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="https://github.com/slaclab/lume-epics/edit/master/docs/Server.md"><i class="fa fa-github"></i> Edit on GitHub</a>
</li>
</ul>
</div>
</div>
</div>
<div class="container">
<div class="row">
<div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
<div class="navbar-header">
<button class="navbar-toggler collapsed" data-target="#toc-collapse" data-toggle="collapse" title="Table of Contents" type="button">
<span class="fa fa-angle-down"></span>
</button>
</div>
<div class="navbar-collapse collapse card bg-secondary" id="toc-collapse">
<ul class="nav flex-column">
<li class="nav-item" data-level="1"><a class="nav-link" href="#epics-server">EPICS Server</a>
<ul class="nav flex-column">
<li class="nav-item" data-level="2"><a class="nav-link" href="#lume_epics.epics_server">lume_epics.epics_server</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#lume_epics.epics_server.CADriver">CADriver</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#lume_epics.epics_server.ModelLoader">ModelLoader</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#lume_epics.epics_server.PVAccessInputHandler">PVAccessInputHandler</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#lume_epics.epics_server.Server">Server</a>
<ul class="nav flex-column">
</ul>
</li>
<li class="nav-item" data-level="2"><a class="nav-link" href="#lume_epics.epics_server.build_pvdb">build_pvdb()</a>
<ul class="nav flex-column">
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div></div>
<div class="col-md-9" role="main">
<h1 id="epics-server">EPICS Server</h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" href="#lume_epics.epics_server" id="lume_epics.epics_server" style="visibility: hidden; width: 0; height: 0;">
</h2>
<div class="doc doc-contents first">
<p>This module contains the EPICS server class along with the associated pvAccess and 
Channel Acccess infrastructure. Included is the Channel Access driver, handlers for 
pvAccess callbacks, and associated utilities. The Server may be optionally initialized
to use only one protocol, using both by default.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="lume_epics.epics_server.CADriver">
<code>CADriver</code>
</h2>
<div class="doc doc-contents">
<p>Class for handling read and write requests to Channel Access process variables.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>input_variables</code></td>
<td><code>List[Variable]</code></td>
<td>
<p>List of lume-model variables to use as 
inputs.</p>
</td>
</tr>
<tr>
<td><code>ouput_variables</code></td>
<td><code>List[Variable]</code></td>
<td>
<p>List of lume-model variables to use as 
outputs.</p>
</td>
</tr>
</tbody>
</table>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.CADriver.read">
<code class="highlight language-python">
read<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pvname</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Method executed by server when clients read a Channel Access process 
variable.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pvname</code></td>
<td><code>str</code></td>
<td>
<p>Process variable name.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>172
173
174
175
176
177
178
179
180</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pvname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
    <span class="sd">"""Method executed by server when clients read a Channel Access process </span>
<span class="sd">    variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        pvname (str): Process variable name.</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="n">pvname</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.CADriver.set_output_pvs">
<code class="highlight language-python">
set_output_pvs<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_variables</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Update output Channel Access process variables after model execution.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>output_variables</code></td>
<td><code>List[lume_model.variables.Variable]</code></td>
<td>
<p>List of output variables.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">set_output_pvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Variable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Update output Channel Access process variables after model execution.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_variables (List[Variable]): List of output variables.</span>
<span class="sd">    """</span>

    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">output_variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Channel Access image process variable </span><span class="si">%s</span><span class="s2"> updated."</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span>
                <span class="n">variable</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">":ArrayData_RBV"</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">":MinX_RBV"</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">x_min</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">":MinY_RBV"</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">y_min</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">":MaxX_RBV"</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">x_max</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">":MaxY_RBV"</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">y_max</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span><span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Channel Access process variable </span><span class="si">%s</span><span class="s2"> updated wth value </span><span class="si">%s</span><span class="s2">."</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span><span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.CADriver.write">
<code class="highlight language-python">
write<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pvname</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Method executed by server when clients write to a Channel Access process
variable.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pvname</code></td>
<td><code>str</code></td>
<td>
<p>Process variable name.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>Union[float, numpy.ndarray]</code></td>
<td>
<p>Value to assign to the process variable.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pvname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">"""Method executed by server when clients write to a Channel Access process</span>
<span class="sd">    variable.</span>


<span class="sd">    Args:</span>
<span class="sd">        pvname (str): Process variable name.</span>

<span class="sd">        value (Union[float, np.ndarray]): Value to assign to the process variable.</span>

<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">pvname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Cannot update variable </span><span class="si">%s</span><span class="s2">. Output variables can only be updated via surrogate model callback."</span><span class="p">,</span> <span class="n">pvname</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>


    <span class="k">if</span> <span class="n">pvname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span><span class="p">[</span><span class="n">pvname</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">pvname</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePVs</span><span class="p">()</span>

        <span class="c1"># trigger model execution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Channel Access process variable </span><span class="si">%s</span><span class="s2"> updated with value </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">pvname</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2"> not found in server variables."</span><span class="p">,</span> <span class="n">pvame</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="lume_epics.epics_server.ModelLoader">
<code>ModelLoader</code>
</h2>
<div class="doc doc-contents">
<p>Subclass of threading.local that initializes the surrogate model in each thread. 
This avoids conflicts that may occur when calling a shared graph between threads.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>model</code></td>
<td><code>SurrogateModel</code></td>
<td>
<p>Surrogate model instance to be executed.</p>
</td>
</tr>
</tbody>
</table>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.ModelLoader.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{})</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>Initializes the online surrogate model.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>model_class</code></td>
<td><code>SurrogateModel</code></td>
<td>
<p>Surrogate Model class to be instantiated. </p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>model_kwargs</code></td>
<td><code>dict</code></td>
<td>
<p>kwargs for initialization</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>273
274
275
276
277
278
279
280
281
282
283
284
285</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="n">SurrogateModel</span><span class="p">,</span> <span class="n">model_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Initializes the online surrogate model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_class (SurrogateModel): Surrogate Model class to be instantiated. </span>

<span class="sd">        model_kwargs (dict): kwargs for initialization</span>
<span class="sd">    """</span>

    <span class="n">surrogate_model</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">(</span><span class="o">**</span><span class="n">model_kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">OnlineSurrogateModel</span><span class="p">(</span>
        <span class="n">surrogate_model</span>
    <span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="lume_epics.epics_server.PVAccessInputHandler">
<code>PVAccessInputHandler</code>
</h2>
<div class="doc doc-contents">
<p>Handler object that defines the callbacks to execute on put operations to input
    process variables.</p>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.PVAccessInputHandler.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>Initialize the handler with prefix and image pv attributes</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prefix</code></td>
<td><code>str</code></td>
<td>
<p>Prefix used to format process variables</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>293
294
295
296
297
298
299
300
301</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Initialize the handler with prefix and image pv attributes</span>

<span class="sd">    Args:</span>
<span class="sd">        prefix (str): Prefix used to format process variables</span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.PVAccessInputHandler.put">
<code class="highlight language-python">
put<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Updates the global input process variable state, posts the input process 
variable value change, runs the thread local OnlineSurrogateModel instance 
using the updated global input process variable states, and posts the model 
output values to the output process variables.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pv</code></td>
<td><code>SharedPV</code></td>
<td>
<p>Input process variable on which the put operates.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>op</code></td>
<td><code>ServOpWrap</code></td>
<td>
<p>Server operation initiated by the put call.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pv</span><span class="p">:</span> <span class="n">SharedPV</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">ServOpWrap</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Updates the global input process variable state, posts the input process </span>
<span class="sd">    variable value change, runs the thread local OnlineSurrogateModel instance </span>
<span class="sd">    using the updated global input process variable states, and posts the model </span>
<span class="sd">    output values to the output process variables.</span>

<span class="sd">    Args:</span>
<span class="sd">        pv (SharedPV): Input process variable on which the put operates.</span>

<span class="sd">        op (ServOpWrap): Server operation initiated by the put call.</span>

<span class="sd">    """</span>
    <span class="k">global</span> <span class="n">providers</span>
    <span class="k">global</span> <span class="n">input_pvs</span>

    <span class="c1"># update input values and global input process variable state</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
    <span class="n">input_pvs</span><span class="p">[</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">:"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

    <span class="c1"># run model using global input process variable state</span>
    <span class="n">output_variables</span> <span class="o">=</span> <span class="n">model_loader</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">input_pvs</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">output_variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"pvAccess image process variable </span><span class="si">%s</span><span class="s2"> updated."</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">nd_array</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">NTNDArrayData</span><span class="p">)</span>

            <span class="c1"># get dw and dh from model output</span>
            <span class="n">nd_array</span><span class="o">.</span><span class="n">attrib</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"x_min"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">x_min</span><span class="p">),</span>
                <span class="s2">"y_min"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">y_min</span><span class="p">),</span>
                <span class="s2">"x_max"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">x_max</span><span class="p">),</span>
                <span class="s2">"y_max"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">y_max</span><span class="p">),</span>
            <span class="p">}</span>

            <span class="n">output_provider</span> <span class="o">=</span> <span class="n">providers</span><span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span><span class="p">]</span>
            <span class="n">output_provider</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">nd_array</span><span class="p">)</span>

        <span class="c1"># do not build attribute pvs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"pvAccess process variable </span><span class="si">%s</span><span class="s2"> updated with value </span><span class="si">%s</span><span class="s2">."</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">output_provider</span> <span class="o">=</span> <span class="n">providers</span><span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span><span class="p">]</span>
            <span class="n">output_provider</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># mark server operation as complete</span>
    <span class="n">op</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="lume_epics.epics_server.Server">
<code>Server</code>
</h2>
<div class="doc doc-contents">
<p>Server for EPICS process variables. Can be optionally initialized with only
pvAccess or Channel Access protocols; but, defaults to serving over both. </p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>model</code></td>
<td><code>OnlineSurrogateModel</code></td>
<td>
<p>OnlineSurrogateModel instance used for getting
predictions.</p>
</td>
</tr>
<tr>
<td><code>input_variables</code></td>
<td><code>List[Variable]</code></td>
<td>
<p>List of lume-model variables passed to model.</p>
</td>
</tr>
<tr>
<td><code>ouput_variables</code></td>
<td><code>List[Variable]</code></td>
<td>
<p>List of lume-model variables to use as 
outputs.</p>
</td>
</tr>
<tr>
<td><code>ca_server</code></td>
<td><code>SimpleServer</code></td>
<td>
<p>Server class that interfaces between the Channel 
Access client and the driver.</p>
</td>
</tr>
<tr>
<td><code>ca_driver</code></td>
<td><code>CADriver</code></td>
<td>
<p>Class used by server to handle to process variable 
read/write requests.</p>
</td>
</tr>
<tr>
<td><code>pva_server</code></td>
<td><code>P4PServer</code></td>
<td>
<p>Threaded p4p server used for serving pvAccess 
variables.</p>
</td>
</tr>
<tr>
<td><code>exit_event</code></td>
<td><code>Event</code></td>
<td>
<p>Threading exit event marking server shutdown.</p>
</td>
</tr>
</tbody>
</table>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.Server.__init__">
<code class="highlight language-python">
__init__<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_class</span><span class="p">,</span> <span class="n">input_variables</span><span class="p">,</span> <span class="n">output_variables</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">protocols</span><span class="o">=</span><span class="p">[</span><span class="s1">'ca'</span><span class="p">,</span> <span class="s1">'pva'</span><span class="p">],</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="p">{})</span> </code>
<span class="doc doc-properties">
<small class="doc doc-property doc-property-special"><code>special</code></small>
</span>
</h3>
<div class="doc doc-contents">
<p>Create OnlineSurrogateModel instance in the main thread and initialize output 
variables by running with the input process variable state, input/output 
variable tracking, start the server, create the process variables, and start 
the driver.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>model_class</code></td>
<td><code>SurrogateModel</code></td>
<td>
<p>Surrogate model class to be instantiated.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>input_variables</code></td>
<td><code>List[lume_model.variables.InputVariable]</code></td>
<td>
<p>Model input variables.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>output_variables</code></td>
<td><code>List[lume_model.variables.OutputVariable]</code></td>
<td>
<p>Model output variables.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefix</code></td>
<td><code>str</code></td>
<td>
<p>Prefix used to format process variables.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>protocols</code></td>
<td><code>List[str]</code></td>
<td>
<p>List of protocols used to instantiate server.</p>
</td>
<td><code>['ca', 'pva']</code></td>
</tr>
<tr>
<td><code>model_kwargs</code></td>
<td><code>dict</code></td>
<td>
<p>Kwargs to instantiate model.</p>
</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model_class</span><span class="p">:</span> <span class="n">SurrogateModel</span><span class="p">,</span>
    <span class="n">input_variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InputVariable</span><span class="p">],</span>
    <span class="n">output_variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputVariable</span><span class="p">],</span>
    <span class="n">prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">protocols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ca"</span><span class="p">,</span> <span class="s2">"pva"</span><span class="p">],</span>
    <span class="n">model_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Create OnlineSurrogateModel instance in the main thread and initialize output </span>
<span class="sd">    variables by running with the input process variable state, input/output </span>
<span class="sd">    variable tracking, start the server, create the process variables, and start </span>
<span class="sd">    the driver.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_class (SurrogateModel): Surrogate model class to be instantiated.</span>

<span class="sd">        input_variables (List[InputVariable]): Model input variables.</span>

<span class="sd">        output_variables (Lis[OutputVariable]): Model output variables.</span>

<span class="sd">        prefix (str): Prefix used to format process variables.</span>

<span class="sd">        protocols (List[str]): List of protocols used to instantiate server.</span>

<span class="sd">        model_kwargs (dict): Kwargs to instantiate model.</span>


<span class="sd">    """</span>
    <span class="c1"># check protocol conditions</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">protocols</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Protocol must be provided to start server."</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">protocol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"ca"</span><span class="p">,</span> <span class="s2">"pva"</span><span class="p">]</span> <span class="k">for</span> <span class="n">protocol</span> <span class="ow">in</span> <span class="n">protocols</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">'Invalid protocol provided. Protocol options are "pva" (pvAccess) and "ca" (Channel Access).'</span>
        <span class="p">)</span>

    <span class="c1"># need these to be global to access from threads</span>
    <span class="k">global</span> <span class="n">providers</span>
    <span class="k">global</span> <span class="n">input_pvs</span>
    <span class="k">global</span> <span class="n">model_loader</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span> <span class="o">=</span> <span class="n">protocols</span>

    <span class="n">providers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">input_pvs</span> <span class="o">=</span> <span class="n">input_variables</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_variables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">output_variables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># update inputs for starting value to be the default</span>
    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variable</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">default</span>

    <span class="c1"># initialize loader for model</span>
    <span class="n">model_loader</span> <span class="o">=</span> <span class="n">ModelLoader</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="n">model_kwargs</span><span class="o">=</span><span class="n">model_kwargs</span><span class="p">,)</span>

    <span class="c1"># get starting output from the model and set up output process variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span> <span class="o">=</span> <span class="n">model_loader</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">"pva"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_pva_server</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.Server.initialize_ca_server">
<code class="highlight language-python">
initialize_ca_server<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Initialize the Channel Access server and driver. Sets the initial
output variable values.</p>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize_ca_server</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Initialize the Channel Access server and driver. Sets the initial</span>
<span class="sd">    output variable values.</span>

<span class="sd">    """</span>
    <span class="c1"># set up db for initializing process variables</span>
    <span class="n">variable_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span>
    <span class="p">}</span>

    <span class="c1"># initialize channel access server</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ca_server</span> <span class="o">=</span> <span class="n">SimpleServer</span><span class="p">()</span>

    <span class="c1"># create all process variables using the process variables stored in pvdb</span>
    <span class="c1"># with the given prefix</span>
    <span class="n">pvdb</span> <span class="o">=</span> <span class="n">build_pvdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ca_server</span><span class="o">.</span><span class="n">createPV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">+</span> <span class="s2">":"</span><span class="p">,</span> <span class="n">pvdb</span><span class="p">)</span>

    <span class="c1"># set up driver for handing read and write requests to process variables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ca_driver</span> <span class="o">=</span> <span class="n">CADriver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ca_driver</span><span class="o">.</span><span class="n">set_output_pvs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.Server.initialize_pva_server">
<code class="highlight language-python">
initialize_pva_server<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Set up pvAccess process variables for serving and start pvAccess server.</p>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">initialize_pva_server</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Set up pvAccess process variables for serving and start pvAccess server.</span>

<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Initializing pvAccess server"</span><span class="p">)</span>
    <span class="c1"># initialize global inputs</span>
    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_variables</span><span class="p">:</span>
        <span class="c1"># input_pvs[variable.name] = variable.value</span>
        <span class="n">pvname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>

        <span class="c1"># prepare scalar variable types</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">==</span> <span class="s2">"scalar"</span><span class="p">:</span>
            <span class="n">pv</span> <span class="o">=</span> <span class="n">SharedPV</span><span class="p">(</span>
                <span class="n">handler</span><span class="o">=</span><span class="n">PVAccessInputHandler</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                <span class="p">),</span>  <span class="c1"># Use PVAccessInputHandler class to handle callbacks</span>
                <span class="n">nt</span><span class="o">=</span><span class="n">NTScalar</span><span class="p">(</span><span class="s2">"d"</span><span class="p">),</span>
                <span class="n">initial</span><span class="o">=</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># prepare image variable types</span>
        <span class="k">elif</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>
            <span class="n">nd_array</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">NTNDArrayData</span><span class="p">)</span>

            <span class="n">nd_array</span><span class="o">.</span><span class="n">attrib</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"x_min"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span>
                <span class="s2">"y_min"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span>
                <span class="s2">"x_max"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span>
                <span class="s2">"y_max"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">pv</span> <span class="o">=</span> <span class="n">SharedPV</span><span class="p">(</span>
                <span class="n">handler</span><span class="o">=</span><span class="n">PVAccessInputHandler</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span>
                <span class="p">),</span>  <span class="c1"># Use PVAccessInputHandler class to handle callbacks</span>
                <span class="n">nt</span><span class="o">=</span><span class="n">NTNDArray</span><span class="p">(),</span>
                <span class="n">initial</span><span class="o">=</span><span class="n">nd_array</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Unsupported variable type provided: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span>
            <span class="p">)</span>

        <span class="n">providers</span><span class="p">[</span><span class="n">pvname</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span>

    <span class="c1"># use default handler for the output process variables</span>
    <span class="c1"># updates to output pvs are handled from post calls within the input update</span>
    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_variables</span><span class="p">:</span>
        <span class="n">pvname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">==</span> <span class="s2">"scalar"</span><span class="p">:</span>
            <span class="n">pv</span> <span class="o">=</span> <span class="n">SharedPV</span><span class="p">(</span><span class="n">nt</span><span class="o">=</span><span class="n">NTScalar</span><span class="p">(),</span> <span class="n">initial</span><span class="o">=</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>

            <span class="n">nd_array</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">NTNDArrayData</span><span class="p">)</span>

            <span class="c1"># get limits from model output</span>
            <span class="n">nd_array</span><span class="o">.</span><span class="n">attrib</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"x_min"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">x_min</span><span class="p">),</span>
                <span class="s2">"y_min"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">y_min</span><span class="p">),</span>
                <span class="s2">"x_max"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">x_max</span><span class="p">),</span>
                <span class="s2">"y_max"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">y_max</span><span class="p">),</span>
            <span class="p">}</span>

            <span class="n">pv</span> <span class="o">=</span> <span class="n">SharedPV</span><span class="p">(</span><span class="n">nt</span><span class="o">=</span><span class="n">NTNDArray</span><span class="p">(),</span> <span class="n">initial</span><span class="o">=</span><span class="n">nd_array</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">"Unsupported variable type provided: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span>
            <span class="p">)</span>

        <span class="n">providers</span><span class="p">[</span><span class="n">pvname</span><span class="p">]</span> <span class="o">=</span> <span class="n">pv</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># throw exception for incorrect data type</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.Server.start">
<code class="highlight language-python">
start<span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Starts server using set server protocol(s).</p>
<p>Args: 
    monitor (bool): Indicates whether to run the server in the background
        or to continually monitor. If monitor = False, the server must be
        explicitely stopped using server.stop()</p>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">monitor</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Starts server using set server protocol(s).</span>

<span class="sd">    Args: </span>
<span class="sd">        monitor (bool): Indicates whether to run the server in the background</span>
<span class="sd">            or to continually monitor. If monitor = False, the server must be</span>
<span class="sd">            explicitely stopped using server.stop()</span>

<span class="sd">    """</span>

    <span class="c1"># set up exit event for threads</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">exit_event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">"ca"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_ca_server</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">"pva"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pva_server</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">monitor</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">"ca"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ca_server</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping servers"</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">"ca"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ca_driver</span><span class="o">.</span><span class="n">exit_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

            <span class="k">if</span> <span class="s2">"pva"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pva_server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.Server.start_ca_server">
<code class="highlight language-python">
start_ca_server<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Starts Channel Access server thread.</p>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>546
547
548
549
550
551
552</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">start_ca_server</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Starts Channel Access server thread.</span>

<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Initializing channel access server"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initialize_ca_server</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Channel access server started"</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.Server.start_pva_server">
<code class="highlight language-python">
start_pva_server<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Starts pvAccess server. </p>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>554
555
556
557
558
559</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">start_pva_server</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">""" Starts pvAccess server. </span>

<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pva_server</span> <span class="o">=</span> <span class="n">P4PServer</span><span class="p">(</span><span class="n">providers</span><span class="o">=</span><span class="p">[</span><span class="n">providers</span><span class="p">])</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"pvAccess server started"</span><span class="p">)</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="lume_epics.epics_server.Server.stop">
<code class="highlight language-python">
stop<span class="p">(</span><span class="bp">self</span><span class="p">)</span> </code>
</h3>
<div class="doc doc-contents">
<p>Stops the server.</p>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span>596
597
598
599
600
601
602
603
604
605
606</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Stops the server.</span>

<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping server."</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">"ca"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ca_driver</span><span class="o">.</span><span class="n">exit_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">"pva"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocols</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pva_server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="lume_epics.epics_server.build_pvdb">
<code class="highlight language-python">
build_pvdb<span class="p">(</span><span class="n">variables</span><span class="p">)</span> </code>
</h2>
<div class="doc doc-contents">
<p>Utility function for building dictionary (pvdb) used to initialize the channel
access server.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>variables</code></td>
<td><code>List[lume_model.variables.Variable]</code></td>
<td>
<p>List of lume_model variables to be served with
channel access server.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>lume_epics/epics_server.py</code></summary>
<table class="highlighttable">
<tr>
<td class="linenos">
<div class="linenodiv">
<pre><span></span> 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
</div>
</td>
<td class="code">
<div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">build_pvdb</span><span class="p">(</span><span class="n">variables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Variable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""Utility function for building dictionary (pvdb) used to initialize the channel</span>
<span class="sd">    access server.</span>

<span class="sd">    Args:</span>
<span class="sd">        variables (List[Variable]): List of lume_model variables to be served with</span>
<span class="sd">            channel access server.</span>

<span class="sd">    """</span>
    <span class="n">pvdb</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">variable_type</span> <span class="o">==</span> <span class="s2">"image"</span><span class="p">:</span>

            <span class="c1"># infer color mode</span>
            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">color_mode</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Color mode cannot be inferred from image shape."</span><span class="p">)</span>

            <span class="c1"># assign default PVS</span>
            <span class="n">pvdb</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:NDimensions_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"float"</span><span class="p">,</span>
                        <span class="s2">"prec"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:Dimensions_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
                        <span class="s2">"prec"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
                        <span class="s2">"count"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:ArraySizeX_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:ArraySizeY_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:ArraySize_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">)),</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:ArrayData_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"float"</span><span class="p">,</span>
                        <span class="s2">"prec"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span>
                        <span class="s2">"count"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">)),</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="c1">#   "units": variable.units,</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:MinX_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"float"</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">x_min</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:MinY_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"float"</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">y_min</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:MaxX_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"float"</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:MaxY_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"float"</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:ColorMode_RBV"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
                        <span class="s2">"value"</span><span class="p">:</span> <span class="n">color_mode</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="s2">"units"</span> <span class="ow">in</span> <span class="n">variable</span><span class="o">.</span><span class="n">__fields_set__</span><span class="p">:</span>
                <span class="n">pvdb</span><span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:ArrayData_RBV"</span><span class="p">][</span><span class="s2">"unit"</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">units</span>

            <span class="c1"># placeholder for color images, not yet implemented</span>
            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">pvdb</span><span class="p">[</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:ArraySizeZ_RBV"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"int"</span><span class="p">,</span>
                    <span class="s2">"value"</span><span class="p">:</span> <span class="n">variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">pvdb</span><span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span>
                <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">by_alias</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">value_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pvdb</span><span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">"hilim"</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">value_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pvdb</span><span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">"lolim"</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">value_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pvdb</span><span class="p">[</span><span class="n">variable</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s2">"unit"</span><span class="p">]</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">units</span>

    <span class="k">return</span> <span class="n">pvdb</span>
</code></pre>
</div>
</td>
</tr>
</table>
</details>
</div>
</div>
</div>
</div>
</div></div>
</div>
</div>
<footer class="col-md-12">
<hr/>
<p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
</footer>
<script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
<script defer="" src="../js/base.js"></script>
<div aria-hidden="true" aria-labelledby="keyboardModalLabel" class="modal" id="mkdocs_keyboard_modal" role="dialog" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
<button class="close" data-dismiss="modal" type="button"><span aria-hidden="true"></span><span class="sr-only">Close</span></button>
</div>
<div class="modal-body">
<table class="table">
<thead>
<tr>
<th style="width: 20%;">Keys</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="help shortcut"><kbd>?</kbd></td>
<td>Open this help</td>
</tr>
<tr>
<td class="next shortcut"><kbd>n</kbd></td>
<td>Next page</td>
</tr>
<tr>
<td class="prev shortcut"><kbd>p</kbd></td>
<td>Previous page</td>
</tr>
<tr>
<td class="search shortcut"><kbd>s</kbd></td>
<td>Search</td>
</tr>
</tbody>
</table>
</div>
<div class="modal-footer">
</div>
</div>
</div>
</div>
</body>
</html>
